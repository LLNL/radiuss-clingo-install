##############################################################################
# Copyright (c) 2019-2021, Lawrence Livermore National Security, LLC and
# RADIUSS project contributors. See the COPYRIGHT file for details.
#
# SPDX-License-Identifier: (MIT)
##############################################################################

# Run a simple jobs to display instructions when no config name was specified.
no-config-name:
  extends: [.on-quartz]
  rules:
    - if: '$CONFIG_NAME == ""'
      when: always
    - when: never
  stage: setup
  script:
    - echo "Variable \"CONFIG_NAME\" was not set."
    - echo "\"CONFIG_NAME\" is required and should point to a config directory."
    - exit 1

.config-defined:
  rules:
    - if: '$CONFIG_NAME == ""'
      when: never
    - when: on_success

.build-job:
  script:
    - mv ~/.spack ~/._spack_saved
    - scripts/get-spack
    - . ${SPACK_PATH}/share/spack/setup-env.sh
    - spack -d spec zlib
  after_script:
    - rm -rf ~/.spack
    - mv ~/._spack_saved ~/.spack

## quartz
quartz:
  extends: [.build-job, .on-quartz, .config-defined]
  stage: build_quartz_default

quartz-gcc-8.3.1:
  extends: [.build-job, .on-quartz, .config-defined]
  before_script:
    - module load gcc/8.3.1
  stage: build_quartz_gcc_8_3_1

quartz-gcc-10.2.1:
  extends: [.build-job, .on-quartz, .config-defined]
  before_script:
    - module load gcc/10.2.1
  stage: build_quartz_gcc_10_2_1

quartz-python-3.8.2:
  extends: [.build-job, .on-quartz, .config-defined]
  before_script:
    - module load python/3.8.2
  stage: build_quartz_python_3_8_2

## ruby
ruby:
  extends: [.build-job, .on-ruby, .config-defined]
  stage: build_ruby_default

## lassen
lassen:
  extends: [.build-job, .on-lassen, .config-defined]
  stage: build_lassen_default

## corona
corona:
  extends: [.build-job, .on-corona, .config-defined]
  stage: build_corona_default
